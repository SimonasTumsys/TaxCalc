#:kivy 1.11.1
#:import utils kivy.utils
#:import F kivy.factory.Factory
#:import NoTransition kivy.uix.screenmanager.NoTransition

WindowManager:
    transition: NoTransition()
    MainWindow:
    CalcWindow:
    EarnWindow:
    StatWindow:
    SettWindow:


<RoundedButton@Button>:
    background_color: (0,0,0,0)
    back_color: utils.get_color_from_hex('#1D7046') ## Green
    back_color_press: utils.get_color_from_hex('#209552') ## Light Green
    canvas.before:
        Color:
            rgba: self.back_color or [0,0,0,0] if self.state == 'normal' else self.back_color_press or [0,0,0,0] 
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [22]
            
<StrokeButton@Button>:
    background_color: (0,0,0,0)
    background_normal: ''
    back_color: utils.get_color_from_hex('#E8E8E8') ## Grey
    back_color_press: utils.get_color_from_hex('#242725') ## Black
    font_color_press: utils.get_color_from_hex('#D3D3D3') ## Font Grey
    border_radius: 25

    ##Font color:
    color: self.back_color_press if self.state == 'normal' else self.font_color_press
    canvas.before:
    ##Color when pressed and not pressed:
        Color:
            rgba: self.back_color or [0,0,0,0] if self.state == 'normal' else self.back_color_press or [0,0,0,0] 
        RoundedRectangle:
            size: self.size
            pos: self.pos
            radius: [25]
    ##Line around button:
    canvas.after:
        Color:
            rgba: self.back_color_press or [0,0,0,0]
        Line:  
            rounded_rectangle: (self.pos[0], self.pos[1], self.size[0], self.size[1], self.border_radius)
            width: 2

<MainWindow>:
    ## App's background color
    canvas.before:
        Color:
            rgba: utils.get_color_from_hex('#49534C') ## Background grey
        Rectangle:
            pos: self.pos
            size: self.size

    name: "main"
    size: root.size

    ##Main window layout:

    FloatLayout:
        Image: ##App banner
            id: 'main_banner'
            source: 'app-banner2.png'
            size: self.texture_size
            pos_hint: {'center_x':0.3, 'center_y': 0.825}
            size_hint: (0.5, 0.5)

        BoxLayout: #Button container with layout, size and spacing
            spacing: 10
            orientation: "vertical"
            size_hint: 0.80, 0.5
            pos_hint: {'center_x': .5, 'center_y': .4}

        ##Main window buttons:

            StrokeButton: ##Calculator button 
                font_size: (root.width + root.height) / 30
                text: app.lang_data[0]['calc']
                font_name: 'DejaVuSans'
                on_release:
                    app.root.current = "calc"

            StrokeButton: ##Enter earnings button
                font_size: (root.width + root.height) / 30
                text: app.lang_data[0]['enter_earn']
                font_name: 'DejaVuSans'
            
            StrokeButton: ##Statistics button
                font_size: (root.width + root.height) / 30
                text: app.lang_data[0]['stats']
                font_name: 'DejaVuSans'
                
            StrokeButton: ##Settings button
                font_size: (root.width + root.height) / 30
                text: app.lang_data[0]['sett']
                font_name: 'DejaVuSans'
                on_release:
                    app.root.current = 'sett'


<CalcWindow>:
    name: "calc"

    canvas.before:
        Color:
            rgba: utils.get_color_from_hex('#49534C')
        Rectangle:
            pos: self.pos
            size: self.size

    GridLayout:
        size_hint: 0.85, 0.5
        pos_hint: {'center_x': .5, 'center_y': .65}
        cols: 1
        spacing: [0,10]
        
        TextInput:
            pos_hint: {'center_x': .5, 'center_y': .85}
            size_hint: 0.4, 0.2
            id: brutt_earn
            multiline: False
            font_size: (root.width + root.height) / 55
            hint_text: app.lang_data[1]['input_ph']
            hint_text_color: utils.get_color_from_hex('#636469')
            input_filter: 'float'
        

        GridLayout:
            cols: 2
            spacing: [5,100]
            row_force_default: True
            row_default_height: self.height*0.2
            StrokeButton:
                font_size: (root.width + root.height) / 35
                text: app.lang_data[1]['submit']
                on_release:
                    root.calculate()

            StrokeButton:
                font_size: (root.width + root.height) / 35
                text: app.lang_data[1]['back']
                on_release: 
                    app.root.current = "main"


<EarnWindow>:
    name: "earn"

<StatWindow>:
    name: "stat"

<SettWindow>:
    name: "sett"

    canvas.before:
        Color:
            rgba: utils.get_color_from_hex('#49534C')
        Rectangle:
            pos: self.pos
            size: self.size

    ##Main layout
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        
        ##Language setting layout
        BoxLayout:
            orientation: 'horizontal'
            spacing: 5
            padding: [0,0,30,0]

            ##Language setting label and button
            Label:
                font_size: (root.width + root.height) / 50
                font_color:
                text: app.lang_data[4]['lang']
            BoxLayout:
                orientation: 'horizontal'
                spacing: 5
                SettingsToggleButton:
                    id: lng_button_lt
                    text: 'Lietuvių'
                    group: 'lng'
                SettingsToggleButton:
                    id: lng_button_en
                    text: 'English'
                    group: 'lng'

        Separator:

        ##PSD setting layout
        BoxLayout:
            orientation: 'horizontal'
            spacing: 5
            padding: [0,0,30,0]

            ##PSD setting label and button
            Label:
                font_size: (root.width + root.height) / 50
                font_color:
                text: 'Fiksuotas PSD'
            BoxLayout:
                orientation: 'horizontal'
                spacing: 5
                SettingsToggleButton:
                    id: psd_button_true
                    text: 'Taip'
                    group: 'psd'
                SettingsToggleButton:
                    id: psd_button_false
                    text: 'Ne'
                    group: 'psd'

        Separator:

        ##Spending setting layout
        BoxLayout:
            orientation: 'horizontal'
            spacing: 5
            padding: [0,0,30,0]

            ##Spending setting label and button
            Label:
                font_size: (root.width + root.height) / 50
                font_color:
                text: 'Išlaidos 30%'
            BoxLayout:
                orientation: 'horizontal'
                spacing: 5
                SettingsToggleButton:
                    id: spend_button_true
                    text: 'Taip'
                    group: 'spend'
                SettingsToggleButton:
                    id: spend_button_false
                    text: 'Ne'
                    group: 'spend'

        Separator:

        ##Pension setting layout
        BoxLayout:
            orientation: 'horizontal'
            spacing: 5
            padding: [0,0,30,0]

            ##Pension setting label and button
            Label:
                font_size: (root.width + root.height) / 50
                font_color:
                text: 'Pensija'
            BoxLayout:
                orientation: 'horizontal'
                spacing: 5
                SettingsToggleButton:
                    id: pension0
                    text: '0'
                    group: 'pension'
                SettingsToggleButton:
                    id: pension27
                    text: '2.7%'
                    group: 'pension'
                SettingsToggleButton:
                    id: pension3
                    text: '3%'
                    group: 'pension'

        Separator:

        GridLayout:
            cols: 2
            spacing: [30,100]
            row_force_default: True
            row_default_height: self.height*0.5
            padding: 30
            StrokeButton:
                font_size: (root.width + root.height) / 35
                text: "Išsaugoti"
                on_release:
                    root.save_settings()

            StrokeButton:
                font_size: (root.width + root.height) / 35
                text: "Atšaukti"
                on_release: 
                    app.root.current = "main"


<Separator@Widget>:
    id: separator
    size_hint_y: None
    height: 6
    canvas:
        Color:
            rgb: 0., 0., 0.
        Rectangle:
            pos: 0, separator.center_y
            size: separator.width, 2

<SettingsToggleButton@ToggleButton>:
    font_size: (root.width + root.height) / 8
    background_color: (0,0,0,0)
    background_normal: ''
    back_color: utils.get_color_from_hex('#E8E8E8') ## Grey
    back_color_press: utils.get_color_from_hex('#242725') ## Black
    font_color_press: utils.get_color_from_hex('#D3D3D3') ## Font Grey
    
    size_hint: (0.25, 0.5)
    pos_hint: {'center_x': 0.5, 'center_y': 0.5}
    
    allow_no_selection: False

    ##Font color when pressed and not pressed
    color: self.back_color_press if self.state == 'down' else self.font_color_press
    ##Color when pressed and not pressed
    canvas.before:
        Color:
            rgba: self.back_color or [0,0,0,0] if self.state == 'down' else self.back_color_press or [0,0,0,0] 
        Rectangle:
            size: self.size
            pos: self.pos
